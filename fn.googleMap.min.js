
(function($){$.fn.googleMap=function(opts,args){if(this.length==0){return false;}
else if(this.length>1){return this.each(function(){$(this).googleMap(opts,args);});}
if(!opts){opts={};}
var $self=this;var defaults={address:'',latitude:0,longitude:0,width:$self.css('width').replace('px',''),height:$self.css('height').replace('px',''),zoom:13,mapType:'roadmap',marker:true,markerTitle:'',markerClick:null,infoBubble:false,infoBubbleContent:'',autoOpenInfo:true,directions:{showSteps:true,container:'',from:'marker',to:'marker',travelMode:'driving'},data:{geocoder:null,latlng:null,map:null,marker:null,infoBubble:null,directionsDisplay:null,directionsService:null,mapOptions:{}}};var settings=this.data('googleMap');var methods={init:function(){settings=defaults;methods.updateSettings(opts);methods.getMap(opts);return $self;},updateSettings:function(newSettings){settings=$.extend(true,settings,newSettings);$self.data('googleMap',settings);},getCenter:function(){return{latitude:settings.latitude,longiutde:settings.longitude};},getMap:function(map_args){if(map_args){methods.updateSettings(map_args);}
if(settings.address){if(!settings.data.geocoder){settings.data.geocoder=new google.maps.Geocoder();}
settings.data.geocoder.geocode({address:settings.address},function(results,status){if(status==google.maps.GeocoderStatus.OK){settings.data.map.setCenter(results[0].geometry.location);if(settings.marker){methods.marker(results[0].geometry.location);}}});}
else{settings.data.latlng=new google.maps.LatLng(settings.latitude,settings.longitude);}
var mapType=google.maps.MapTypeId.ROADMAP;if(settings.mapType.toUpperCase()in google.maps.MapTypeId){mapType=google.maps.MapTypeId[settings.mapType.toUpperCase()];}
settings.data.mapOptions={zoom:settings.zoom,center:settings.data.latlng,mapTypeId:mapType};settings.data.map=new google.maps.Map(document.getElementById($self.attr('id')),settings.data.mapOptions);if(settings.marker&&settings.data.latlng){methods.marker(settings.data.latlng);}
if(settings.infoBubble){methods.infoBubble();}
methods.updateSettings(settings);return $self;},marker:function(pos){if(!pos&&settings.data.latlng){pos=settings.data.latlng;}
settings.data.marker=new google.maps.Marker({position:pos,map:settings.data.map,title:settings.markerTitle});google.maps.event.addListener(settings.data.marker,'click',function(){methods.markerClick();});return $self;},markerClick:function(){if(settings.infoBubble){settings.data.infoBubble.open(settings.data.map,settings.data.marker);}
if(settings.markerClick){settings.markerClick();}
return $self;},getDirections:function(args){if(args){methods.updateSettings({directions:args});}
settings.data.directionsService=new google.maps.DirectionsService();if(!settings.data.directionsDisplay){settings.data.directionsDisplay=new google.maps.DirectionsRenderer();settings.data.directionsDisplay.setMap(settings.data.map);}
if(settings.directions.showSteps){settings.data.directionsDisplay.setPanel(document.getElementById(settings.directions.container));}
var mode=google.maps.TravelMode.DRIVING;if(settings.directions.travelMode.toUpperCase()in google.maps.TravelMode){mode=google.maps.TravelMode[settings.directions.travelMode.toUpperCase()];}
if(settings.directions.from=='marker'){settings.directions.from=settings.data.latlng;}
else if(settings.directions.to=='marker'){settings.directions.to=settings.data.latlng;}
var request={origin:settings.directions.from,destination:settings.directions.to,travelMode:mode};settings.data.directionsService.route(request,function(result,status){if(status==google.maps.DirectionsStatus.OK){settings.data.directionsDisplay.setDirections(result);}});methods.updateSettings(settings);return $self;},infoBubble:function(args){if(args){methods.updateSettings(args);}
settings.data.infoBubble=new google.maps.InfoWindow({content:settings.infoBubbleContent});if(settings.autoOpenInfo){settings.data.infoBubble.open(settings.data.map,settings.data.marker);}
methods.updateSettings(settings);return $self;}};if(typeof(opts)=='string'){if(methods.hasOwnProperty(opts)){return methods[opts](args);}
return $self;}
if(typeof(google)!='undefined'){return methods.init(opts);}
else{return $self;}}})(jQuery);